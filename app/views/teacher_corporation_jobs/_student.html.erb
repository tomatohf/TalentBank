<%
	student_number = h(student.number)
	university = University.find(student.university_id)
	college = university && College.find(university[:id], student.college_id)
	major = college && Major.find(college[:id], student.major_id)
	edu_level = EduLevel.find(student.edu_level_id)
	
	profile = student.profile
	
	weight = match[:weight]
	attributes = match[:attributes]
	
	matched_wishes = []
	matched_wishes << "行业大类" if attributes["intern_wish_industry_category_id"].include?(@profile.industry_category_id)
	matched_wishes << "行业细分" if attributes["intern_wish_industry_id"].include?(@profile.industry_id)
	matched_wishes << "企业性质" if attributes["intern_wish_nature_id"].include?(@profile.nature_id)
	matched_wishes << "岗位大类" if attributes["intern_wish_job_category_class_id"].include?(@job.category_class_id)
	matched_wishes << "岗位细分" if attributes["intern_wish_job_category_id"].include?(@job.category_id)
	matched_wishes << "工作区域" if attributes["intern_wish_job_district_id"].include?(@job.district_id)
	
	marked_teacher_id = student.get_calling_mark
%>

<tr<%= %Q! class="odd"! if counter.even? %>>
	<td valign="top">
		<div>
			<span class="matched_student_title"><%= h(student.name) %></span>
			<a href="/teachers/<%= @teacher.id %>/students?n=<%= student_number %>" target="_blank" class="none">
				<%= student_number %></a>
		</div>
		
		<div class="matched_student_info">
			<% if profile %>
				<%= h(profile.phone) %>
				<br />
				<%= h(profile.email) %>
				<br />
			<% end %>
			
			<%= university && university[:name] %>
			
			<br />
			
			<% if college %>
				<%= college[:name] %>
			<% end %>
			<% if major %>
				›
				<%= major[:name] %>
			<% end %>
		</div>
	</td>
	
	<td valign="top">
		<div class="matched_student_info">
			<% if matched_wishes.size > 0 %>
				<% matched_wishes.each do |wish| %>
					<span title="满足其对 <%= wish %> 的实习意愿" class="matched_wish"><%= wish %></span>
				<% end %>
			<% else %>
				(不满足任何实习意愿)
			<% end %>
		</div>
		
		<div class="matched_student_info">
			<%= format_date(Time.at(attributes["intern_begin_at"])) unless attributes["intern_begin_at"].blank? %>
			<% workday = JobWorkday.find(attributes["intern_workday_id"]) %>
			<% if workday %>
				›
				<%= workday[:name] %>
			<% end %>
		
			<br />
		
			<% period = JobPeriod.find(attributes["intern_period_id"]) %>
			<% if period %>
				<%= period[:name] %>
				›
			<% end %>
			<% unless attributes["intern_salary"].blank? %>
				<%= attributes["intern_salary"] %> 元/天
			<% end %>
			
			<br />
			
			<%= edu_level[:name] %>
			›
			<%= student.graduation_year %> 年毕业
			<%=
				year = @school.coming_graduation_year
				if student.graduation_year == year
					"(应届毕业)"
				elsif student.graduation_year > year
					"(在读学生)"
				else
					"(已经毕业)"
				end
			%>
			
			<br />
			
			<% job_major = JobMajor.find(attributes["intern_major_id"]) %>
			<% if job_major %>
				<%= job_major[:name] %>
			<% end %>
		</div>
	</td>
	
	<td valign="top">
		<div>
			<% if marked_teacher_id %>
				通话中 ...
			<% end %>
		</div>
		
		<div>
			<%= intern_log ? intern_log.determine_status : InternLog::Status[:unemployed] %>
		</div>
		
		<% if intern_log %>
			<div>
				最近状态:
				
			</div>
		<% end %>
	</td>
	
	<td valign="top" class="matched_student_actions">
		<% if marked_teacher_id %>
			<% if marked_teacher_id == @teacher.id %>
				<a href="#">清除标记</a>
			<% else %>
				<span class="info">标记通话</span>
			<% end %>
		<% else %>
			<a href="#">标记通话</a>
		<% end %>
		<a href="#">通知面试</a>
		<a href="#">刷新状态</a>
	</td>
</tr>
