<% talent_page_title("学院统计") %>


<h2>学院统计</h2>

<%=
	render(
		:partial => "filters",
		:locals => {
			:views => [["bar", "查看柱图"], ["pie", "查看饼图"]],
			:views_style => {:width => 21, :right => 8},
			:hide => [:dataset]
		}
	)
%>

<div>
	<%
		graph_width = 350
		
		percent_format = "%.1f"
	%>
	<table border="0" cellspacing="0" cellpadding="0" class="main_part_w grid">
		<thead>
			<tr>
				<td style="width: 25px;"></td>
				<td><%= @groups_name %></td>
				<td>查看简历数</td>
				<td style="width: <%= graph_width %>px;"></td>
			</tr>
		</thead>
		
		<tbody>
			<% @counts.each_index do |i| %>
				<tr<%= %Q! class="odd"! if i.odd? %>>
					<%
						group = @counts[i][1]["@groupby"]
						count = @counts[i][1]["@count"]
					%>

					<td align="center"><%= i+1 %></td>

					<td>
						<%= @group_title_proc.call(group) %>
					</td>

					<td align="right" style="font-weight: bold;">
						<%= count %>
					</td>

					<% unless @view == "pie" %>
						<td>
							<%
								width = (graph_width-50) * (count.to_f/@max)
								percent = percent_format % ((count.to_f/@total_count)*100)
							%>

							<div class="graph_bar" style="background-color: #FF6600; width: <%= width.round %>px;"></div>
							<%= percent %>%
						</td>
					<% else %>
						<% unless i > 0 %>
							<td rowspan="<%= @counts.size %>" style="background-color: #FFFFFF;">
								<div>
									<%= render(
										:partial => "ofc",
										:locals => {
											:chart_id => "pie_chart",
											:height => graph_width,
											:data => @chart_data
										}
									) %>
								</div>
							</td>
						<% end %>
					<% end %>
				</tr>
			<% end %>
		</tbody>
	</table>
</div>


<%= render :partial => "scripts", :locals => {:slider => true} %>
